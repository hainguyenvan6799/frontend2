{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projects_User\\\\lucky\\\\full_project\\\\frontend\\\\src\\\\Store.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { get_magiaovien } from \"./components/page/User/Login1\";\nimport { giaimadulieu, mahoadulieu_postform } from \"./components/page/security\";\nimport Pusher from \"pusher-js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst PusherBackend = require(\"pusher\");\n\nconst pusherFrontend = new Pusher(\"2b03e0ab05c69b7c59b7\", {\n  cluster: \"ap1\",\n  encrypted: true\n});\nexport const channel = pusherFrontend.subscribe(\"contain_files\");\nexport const channel1 = pusherFrontend.subscribe(\"notification\");\nexport const channel2 = pusherFrontend.subscribe(\"topics\");\nexport const channel3 = pusherFrontend.subscribe(\"scheduleCalendar\");\nchannel.bind(\"pusher:subscription_succeeded\", function (members) {});\nchannel.bind(\"add_files\", function (data) {\n  alert(data);\n}); // create context area\n\nexport const userContext = /*#__PURE__*/React.createContext({\n  name: \"\",\n  email: \"\",\n  is_updated_info: 0,\n  mauser: \"\",\n  sex: \"\"\n});\nexport const loadingContext = /*#__PURE__*/React.createContext(false);\nexport const validationContext = /*#__PURE__*/React.createContext({\n  validation_all: {\n    status: null,\n    message: \"\"\n  },\n  validation_email: {\n    status: null,\n    message: \"\"\n  },\n  validation_password: {\n    status: null,\n    message: \"\"\n  }\n});\n\nfunction Store({\n  children\n}) {\n  _s();\n\n  const [user, setUser] = useState(userContext._currentValue);\n  const [loading, setLoading] = useState(loadingContext._currentValue);\n  const [general_validation, setGeneralValidation] = useState(validationContext._currentValue);\n  const isMountedVal = React.useRef(1);\n  useEffect(() => {\n    console.log(\"đã thực hiện\");\n\n    if (isMountedVal.current === 1) {\n      check_login();\n    }\n\n    return () => {\n      console.log(\"Thực hiện isMountedVal = 0\");\n      isMountedVal.current = 0;\n    };\n  }, [isMountedVal]);\n  useEffect(() => {\n    Pusher.logToConsole = true; // const pusher = new PusherBackend({\n    //   appId: \"1211732\",\n    //   key: \"2b03e0ab05c69b7c59b7\",\n    //   secret: \"2f3702fb4c2927a74e72\",\n    //   cluster: \"ap1\",\n    //   port: \"3000\",\n    //   encrypted: true,\n    // });\n    // pusher.trigger('chat', 'message', {username: \"NguyenVanHai\"});\n  });\n\n  const check_login = async () => {\n    let token = localStorage.getItem(\"token\");\n\n    if (token) {\n      setLoading(true);\n      axios.get(\"/api/user\").then(res => {\n        if (res.data.status === \"success\") {\n          const users = res.data.users;\n          let {\n            name,\n            email,\n            is_updated_info,\n            mauser,\n            sex,\n            group,\n            malop,\n            user_chat_id\n          } = res.data.user;\n          const magiaovien = giaimadulieu(res.data.magiaovien);\n          console.log(magiaovien);\n          setUser({ ...user,\n            name: name,\n            email: email,\n            is_updated_info: is_updated_info,\n            mauser: mauser,\n            sex: sex,\n            group: group,\n            malop: malop,\n            magiaovien: magiaovien,\n            user_chat_id\n          });\n          setLoading(false);\n        } else {\n          localStorage.clear();\n          window.location.href = \"/signin\";\n        }\n      }).catch(err => {\n        if (err) {\n          localStorage.clear();\n          window.location.href = \"/signin\";\n        }\n      });\n    }\n  }; //     axios.get('/api/user')\n  //         .then(\n  //             res => {\n  //                 if (isMounted) {\n  //                     // console.log(res);\n  //                     if (res.data.status === \"success\") {\n  //                         // console.log(\"success\");\n  //                         let { name, email, is_updated_info, mauser, sex, group } = res.data.user;\n  //                         setUser({\n  //                             ...user,\n  //                             name: name,\n  //                             email: email,\n  //                             is_updated_info: is_updated_info,\n  //                             mauser: mauser,\n  //                             sex: sex,\n  //                             group: group,\n  //                             magiaovien: res.data.magiaovien,\n  //                         })\n  //                     }\n  //                 }\n  //                 setLoading(false);\n  //             }\n  //         )\n  //         .catch(\n  //             error => {\n  //                 if (token) {\n  //                     localStorage.clear();\n  //                     alert(\"Đã hết thời gian đăng nhập. Vui lòng tải lại trang.\")\n  //                     return <Redirect to=\"/signin\" />\n  //                 }\n  //             }\n  //         )\n  // }\n\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(userContext.Provider, {\n      value: [user, setUser],\n      children: /*#__PURE__*/_jsxDEV(loadingContext.Provider, {\n        value: [loading, setLoading],\n        children: /*#__PURE__*/_jsxDEV(validationContext.Provider, {\n          value: [general_validation, setGeneralValidation],\n          children: children\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 166,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Store, \"c20oU3Wrzqtc4oZO549hogDyz24=\");\n\n_c = Store;\nexport default Store;\n\nvar _c;\n\n$RefreshReg$(_c, \"Store\");","map":{"version":3,"sources":["C:/Projects_User/lucky/full_project/frontend/src/Store.js"],"names":["React","useState","useEffect","axios","get_magiaovien","giaimadulieu","mahoadulieu_postform","Pusher","PusherBackend","require","pusherFrontend","cluster","encrypted","channel","subscribe","channel1","channel2","channel3","bind","members","data","alert","userContext","createContext","name","email","is_updated_info","mauser","sex","loadingContext","validationContext","validation_all","status","message","validation_email","validation_password","Store","children","user","setUser","_currentValue","loading","setLoading","general_validation","setGeneralValidation","isMountedVal","useRef","console","log","current","check_login","logToConsole","token","localStorage","getItem","get","then","res","users","group","malop","user_chat_id","magiaovien","clear","window","location","href","catch","err"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { get_magiaovien } from \"./components/page/User/Login1\";\r\nimport { giaimadulieu, mahoadulieu_postform } from \"./components/page/security\";\r\nimport Pusher from \"pusher-js\";\r\nconst PusherBackend = require(\"pusher\");\r\nconst pusherFrontend = new Pusher(\"2b03e0ab05c69b7c59b7\", {\r\n  cluster: \"ap1\",\r\n  encrypted: true,\r\n});\r\nexport const channel = pusherFrontend.subscribe(\"contain_files\");\r\nexport const channel1 = pusherFrontend.subscribe(\"notification\");\r\nexport const channel2 = pusherFrontend.subscribe(\"topics\");\r\nexport const channel3 = pusherFrontend.subscribe(\"scheduleCalendar\");\r\n\r\nchannel.bind(\"pusher:subscription_succeeded\", function (members) {});\r\nchannel.bind(\"add_files\", function (data) {\r\n  alert(data);\r\n});\r\n\r\n// create context area\r\nexport const userContext = React.createContext({\r\n  name: \"\",\r\n  email: \"\",\r\n  is_updated_info: 0,\r\n  mauser: \"\",\r\n  sex: \"\",\r\n});\r\nexport const loadingContext = React.createContext(false);\r\nexport const validationContext = React.createContext({\r\n  validation_all: {\r\n    status: null,\r\n    message: \"\",\r\n  },\r\n  validation_email: {\r\n    status: null,\r\n    message: \"\",\r\n  },\r\n  validation_password: {\r\n    status: null,\r\n    message: \"\",\r\n  },\r\n});\r\n\r\nfunction Store({ children }) {\r\n  const [user, setUser] = useState(userContext._currentValue);\r\n  const [loading, setLoading] = useState(loadingContext._currentValue);\r\n  const [general_validation, setGeneralValidation] = useState(\r\n    validationContext._currentValue\r\n  );\r\n\r\n  const isMountedVal = React.useRef(1);\r\n\r\n  useEffect(() => {\r\n    console.log(\"đã thực hiện\");\r\n\r\n    if (isMountedVal.current === 1) {\r\n      check_login();\r\n    }\r\n\r\n    return () => {\r\n      console.log(\"Thực hiện isMountedVal = 0\");\r\n      isMountedVal.current = 0;\r\n    };\r\n  }, [isMountedVal]);\r\n\r\n  useEffect(() => {\r\n    Pusher.logToConsole = true;\r\n    // const pusher = new PusherBackend({\r\n    //   appId: \"1211732\",\r\n    //   key: \"2b03e0ab05c69b7c59b7\",\r\n    //   secret: \"2f3702fb4c2927a74e72\",\r\n    //   cluster: \"ap1\",\r\n    //   port: \"3000\",\r\n    //   encrypted: true,\r\n    // });\r\n    // pusher.trigger('chat', 'message', {username: \"NguyenVanHai\"});\r\n  });\r\n\r\n  const check_login = async () => {\r\n    let token = localStorage.getItem(\"token\");\r\n\r\n    if (token) {\r\n      setLoading(true);\r\n      axios\r\n        .get(\"/api/user\")\r\n        .then((res) => {\r\n          if (res.data.status === \"success\") {\r\n            const users = res.data.users;\r\n            let {\r\n              name,\r\n              email,\r\n              is_updated_info,\r\n              mauser,\r\n              sex,\r\n              group,\r\n              malop,\r\n              user_chat_id,\r\n            } = res.data.user;\r\n            const magiaovien = giaimadulieu(res.data.magiaovien);\r\n            console.log(magiaovien);\r\n            setUser({\r\n              ...user,\r\n              name: name,\r\n              email: email,\r\n              is_updated_info: is_updated_info,\r\n              mauser: mauser,\r\n              sex: sex,\r\n              group: group,\r\n              malop: malop,\r\n              magiaovien: magiaovien,\r\n              user_chat_id,\r\n            });\r\n            setLoading(false);\r\n          } else {\r\n            localStorage.clear();\r\n            window.location.href = \"/signin\";\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (err) {\r\n            localStorage.clear();\r\n            window.location.href = \"/signin\";\r\n          }\r\n        });\r\n    }\r\n  };\r\n\r\n  //     axios.get('/api/user')\r\n  //         .then(\r\n  //             res => {\r\n  //                 if (isMounted) {\r\n  //                     // console.log(res);\r\n  //                     if (res.data.status === \"success\") {\r\n  //                         // console.log(\"success\");\r\n  //                         let { name, email, is_updated_info, mauser, sex, group } = res.data.user;\r\n\r\n  //                         setUser({\r\n  //                             ...user,\r\n  //                             name: name,\r\n  //                             email: email,\r\n  //                             is_updated_info: is_updated_info,\r\n  //                             mauser: mauser,\r\n  //                             sex: sex,\r\n  //                             group: group,\r\n  //                             magiaovien: res.data.magiaovien,\r\n  //                         })\r\n  //                     }\r\n\r\n  //                 }\r\n  //                 setLoading(false);\r\n  //             }\r\n  //         )\r\n  //         .catch(\r\n  //             error => {\r\n  //                 if (token) {\r\n  //                     localStorage.clear();\r\n  //                     alert(\"Đã hết thời gian đăng nhập. Vui lòng tải lại trang.\")\r\n  //                     return <Redirect to=\"/signin\" />\r\n  //                 }\r\n  //             }\r\n  //         )\r\n  // }\r\n\r\n  return (\r\n    <div>\r\n      <userContext.Provider value={[user, setUser]}>\r\n        <loadingContext.Provider value={[loading, setLoading]}>\r\n          <validationContext.Provider\r\n            value={[general_validation, setGeneralValidation]}\r\n          >\r\n            {children}\r\n          </validationContext.Provider>\r\n        </loadingContext.Provider>\r\n      </userContext.Provider>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Store;\r\n"]},"metadata":{},"sourceType":"module"}