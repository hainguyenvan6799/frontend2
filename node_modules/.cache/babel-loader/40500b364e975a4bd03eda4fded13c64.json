{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projects_User\\\\lucky\\\\full_project\\\\frontend\\\\src\\\\components\\\\page\\\\User\\\\DienDan\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport axios from 'axios';\nimport React from 'react';\nimport { userContext } from '../../../../Store';\nimport DanhSachDienDan from './DanhSachDienDan';\nimport { mahoadulieu_postform } from '../../security';\nimport ClipLoader from \"react-spinners/ClipLoader\";\nimport { channel1 } from \"../../../../Store\";\nimport { channel2 } from \"../../../../Store\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction DienDan(props) {\n  _s();\n\n  const [topics, setTopics] = React.useState([]);\n  const [topicsPending, setTopicsPending] = React.useState([]);\n  const [loading, setLoading] = React.useState(true);\n  const [user, setUser] = React.useContext(userContext);\n  const [allUsers, setAllUsers] = React.useState([]);\n  const [notification, setNotification] = React.useState([]);\n  var isMounted = true;\n  console.log(props.isCreateTopicResource);\n  console.log(\"accessright\", props.accessRightsForum);\n\n  const retrieveTopics = async () => {\n    const resource_id = `chude_${user.malop}`;\n    const encryptedResourceID = mahoadulieu_postform(resource_id);\n    const response = await axios.post('/api/topics', {\n      resource_id: encryptedResourceID\n    });\n\n    if (response.data.status) {\n      setAllUsers([...response.data.users]);\n      return response.data.data;\n    }\n  };\n\n  const get_username_of_mauser = checkMauser => {\n    const user = allUsers.find(({\n      mauser\n    }) => mauser === checkMauser);\n    return user.name;\n  };\n\n  const addTopic = async (topic, active) => {\n    //         const response = \n    await axios.post('/api/add-topic', topic, {\n      \"Content-Type\": \"multipart/form-data\"\n    }); //         console.log(response)\n    //         if (response.data.status) {\n    //             if(active)\n    //             {\n    //                 setTopics((topics) => [...topics, response.data.data]);\n    //             }\n    //             else\n    //             {\n    //                 setTopicsPending((topics) => [...topics, response.data.data]);\n    //             }\n    //         }\n  };\n\n  const deleteTopic = async (id, type) => {\n    //         const response = \n    await axios.delete(`/api/delete-topic/${id}`); //         if (response.data.status) {\n    //             if(type === \"pending\")\n    //             {\n    //                 const new_data_topics = topicsPending.filter(item => item._id !== id)\n    //                 setTopicsPending(new_data_topics)\n    //             }\n    //             else\n    //             {\n    //                 const new_data_topics = topics.filter(item => item._id !== id)\n    //                 setTopics(new_data_topics);\n    //             }\n    //         }\n  };\n\n  const editTopic = async (topicEdited, id, active) => {\n    //         const response = \n    await axios.put(`api/edit-topic/${id}`, topicEdited); //         console.log(response)\n    //         if (response.data.status) {\n    //             if(active)\n    //             {\n    //                 const new_data_topics = topics.map(item => item._id === id ? response.data.data : item);\n    //                 setTopics(new_data_topics)\n    //             }\n    //             else\n    //             {\n    //                 const newData = topics.filter(item => item._id !== id);\n    //                 setTopics(newData);\n    //                 setTopicsPending([...topicsPending, response.data.data]);\n    //             }\n    //         }\n  };\n\n  const handleApprove = async id => {\n    const data = {\n      'id': id\n    }; //         const result = \n\n    await axios.post('/api/chap-nhan-chu-de', data); //         if (result.data.status) {\n    //             const item = result.data.data;\n    //             setTopics((topics) => [...topics, item]);\n    //             const new_data_pending = topicsPending.filter(item => item._id !== id);\n    //             setTopicsPending(new_data_pending);\n    //         }\n  };\n\n  const CreateANewTopicResource = (malop, nameOfResource) => {\n    props.CreateANewTopicResource(malop, nameOfResource);\n  };\n\n  React.useEffect(() => {\n    const getTopics = async () => {\n      const allTopics = await retrieveTopics();\n\n      if (isMounted) {\n        allTopics.map(item => {\n          if (item.active) {\n            setTopics(topics => [...topics, item]);\n          } else {\n            setTopicsPending(topics => [...topics, item]);\n          }\n        });\n        setLoading(false);\n      }\n    };\n\n    getTopics();\n    return () => {\n      isMounted = false;\n      setLoading(false);\n    };\n  }, []);\n  React.useEffect(() => {\n    channel1.bind(\"App\\\\Events\\\\Notification\", data => {\n      setNotification(noti => [...noti, data.data]);\n    });\n  }, []);\n  React.useEffect(() => {\n    channel2.bind(\"App\\\\Events\\\\Topic\", data => {\n      if (data.data.resource_id === `chude_${user.malop}`) {\n        if (data.data.isDelete) {\n          if (data.data.active) {\n            //   const newData = tailieu.filter((item) => item._id !== data.data._id);\n            setTopics(topics => topics.filter(item => item._id !== data.data._id));\n          } else {\n            setTopicsPending(topics => topics.filter(item => item._id !== data.data._id));\n          }\n        }\n\n        if (data.data.isAdd === true) {\n          let item = data.data;\n          item._id = item._id;\n\n          if (item.active === true) {\n            setTopics(topics => [...topics, item]);\n          } else {\n            setTopicsPending(topics => [...topics, item]);\n          }\n        }\n\n        if (data.data.isUpdate === true) {\n          if (data.data.active) {\n            setTopics(topics => topics.map(item => item._id === data.data._id ? data.data : item));\n          } else {\n            setTopics(topics => topics.filter(item => item._id !== data.data._id));\n            setTopicsPending(topics => [...topics, data.data]);\n          }\n        }\n\n        if (data.data.isApprove === true) {\n          setTopics(topics => [...topics, data.data]);\n          setTopicsPending(topics => topics.filter(item => item._id !== data.data._id));\n        }\n      }\n    });\n  }, []);\n  return loading ? /*#__PURE__*/_jsxDEV(ClipLoader, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 205,\n    columnNumber: 19\n  }, this) : props.accessRightsForum.allowRead === true ? props.isCreateTopicResource !== null ? props.isCreateTopicResource === true ? /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(DanhSachDienDan, {\n      notification: notification,\n      topics: topics,\n      topicsPending: topicsPending,\n      userlogin: user,\n      handleCreate: addTopic,\n      handleDelete: deleteTopic,\n      handleEdit: editTopic,\n      handleApprove: handleApprove,\n      accessRights: props.accessRightsForum,\n      getUserNameOfUser: get_username_of_mauser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 17\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 13\n  }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n    className: \"btn btn-primary\",\n    onClick: () => CreateANewTopicResource(props.user.malop, `Chủ đề của lớp ${props.privateInfo.tenlop}`),\n    children: \"Nh\\u1EA5n v\\xE0o \\u0111\\xE2y \\u0111\\u1EC3 t\\u1EA1o m\\u1EDBi m\\u1ED9t resource\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 220,\n    columnNumber: 22\n  }, this) : \"...Loading...\" : props.accessRightsForum.allowRead === false ? /*#__PURE__*/_jsxDEV(\"h5\", {\n    children: \"B\\u1EA1n kh\\xF4ng \\u0111\\u01B0\\u1EE3c ph\\xE9p truy c\\u1EADp v\\xE0o trang n\\xE0y.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 221,\n    columnNumber: 61\n  }, this) : \"...Loading...\";\n}\n\n_s(DienDan, \"azhTBrc8ldL181x1pkl11CeOU0k=\");\n\n_c = DienDan;\nexport default DienDan;\n\nvar _c;\n\n$RefreshReg$(_c, \"DienDan\");","map":{"version":3,"sources":["C:/Projects_User/lucky/full_project/frontend/src/components/page/User/DienDan/index.js"],"names":["axios","React","userContext","DanhSachDienDan","mahoadulieu_postform","ClipLoader","channel1","channel2","DienDan","props","topics","setTopics","useState","topicsPending","setTopicsPending","loading","setLoading","user","setUser","useContext","allUsers","setAllUsers","notification","setNotification","isMounted","console","log","isCreateTopicResource","accessRightsForum","retrieveTopics","resource_id","malop","encryptedResourceID","response","post","data","status","users","get_username_of_mauser","checkMauser","find","mauser","name","addTopic","topic","active","deleteTopic","id","type","delete","editTopic","topicEdited","put","handleApprove","CreateANewTopicResource","nameOfResource","useEffect","getTopics","allTopics","map","item","bind","noti","isDelete","filter","_id","isAdd","isUpdate","isApprove","allowRead","privateInfo","tenlop"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport React from 'react'\r\nimport { userContext } from '../../../../Store';\r\nimport DanhSachDienDan from './DanhSachDienDan';\r\nimport { mahoadulieu_postform } from '../../security';\r\nimport ClipLoader from \"react-spinners/ClipLoader\";\r\nimport { channel1 } from \"../../../../Store\";\r\nimport { channel2 } from \"../../../../Store\";\r\n\r\nfunction DienDan(props) {\r\n    const [topics, setTopics] = React.useState([]);\r\n    const [topicsPending, setTopicsPending] = React.useState([]);\r\n    const [loading, setLoading] = React.useState(true)\r\n    \r\n    const [user, setUser] = React.useContext(userContext);\r\n    const [allUsers, setAllUsers] = React.useState([]);\r\n    const [notification, setNotification] = React.useState([]);\r\n    var isMounted = true;\r\n\r\n    console.log(props.isCreateTopicResource)\r\n    console.log(\"accessright\", props.accessRightsForum);\r\n\r\n    const retrieveTopics = async () => {\r\n        const resource_id = `chude_${user.malop}`;\r\n        const encryptedResourceID = mahoadulieu_postform(resource_id)\r\n        const response = await axios.post('/api/topics', { resource_id: encryptedResourceID });\r\n        if (response.data.status) {\r\n            setAllUsers([...response.data.users]);\r\n            return response.data.data;\r\n        }\r\n    }\r\n\r\n    const get_username_of_mauser = (checkMauser) => {\r\n        const user = allUsers.find( ({mauser}) => mauser === checkMauser )\r\n        return user.name;\r\n    }\r\n\r\n    const addTopic = async (topic, active) => {\r\n\r\n//         const response = \r\n              await axios.post('/api/add-topic', topic, {\r\n            \"Content-Type\": \"multipart/form-data\"\r\n        });\r\n//         console.log(response)\r\n//         if (response.data.status) {\r\n//             if(active)\r\n//             {\r\n//                 setTopics((topics) => [...topics, response.data.data]);\r\n//             }\r\n//             else\r\n//             {\r\n//                 setTopicsPending((topics) => [...topics, response.data.data]);\r\n//             }\r\n//         }\r\n\r\n    }\r\n\r\n    const deleteTopic = async (id, type) => {\r\n//         const response = \r\n        await axios.delete(`/api/delete-topic/${id}`);\r\n//         if (response.data.status) {\r\n\r\n            \r\n//             if(type === \"pending\")\r\n//             {\r\n//                 const new_data_topics = topicsPending.filter(item => item._id !== id)\r\n//                 setTopicsPending(new_data_topics)\r\n//             }\r\n//             else\r\n//             {\r\n//                 const new_data_topics = topics.filter(item => item._id !== id)\r\n//                 setTopics(new_data_topics);\r\n//             }\r\n//         }\r\n    }\r\n\r\n    const editTopic = async (topicEdited, id, active) => {\r\n//         const response = \r\n        await axios.put(`api/edit-topic/${id}`, topicEdited);\r\n//         console.log(response)\r\n//         if (response.data.status) {\r\n//             if(active)\r\n//             {\r\n//                 const new_data_topics = topics.map(item => item._id === id ? response.data.data : item);\r\n//                 setTopics(new_data_topics)\r\n                \r\n//             }\r\n//             else\r\n//             {\r\n//                 const newData = topics.filter(item => item._id !== id);\r\n//                 setTopics(newData);\r\n//                 setTopicsPending([...topicsPending, response.data.data]);\r\n//             }\r\n            \r\n//         }\r\n    }\r\n\r\n    const handleApprove = async (id) => {\r\n        const data = {\r\n            'id': id\r\n        }\r\n//         const result = \r\n        await axios.post('/api/chap-nhan-chu-de', data);\r\n//         if (result.data.status) {\r\n//             const item = result.data.data;\r\n//             setTopics((topics) => [...topics, item]);\r\n\r\n//             const new_data_pending = topicsPending.filter(item => item._id !== id);\r\n//             setTopicsPending(new_data_pending);\r\n//         }\r\n    }\r\n\r\n    const CreateANewTopicResource = (malop, nameOfResource) => {\r\n        props.CreateANewTopicResource(malop, nameOfResource);\r\n    }\r\n\r\n    React.useEffect(() => {\r\n        const getTopics = async () => {\r\n            const allTopics = await retrieveTopics();\r\n            \r\n            if(isMounted)\r\n            {\r\n                allTopics.map(item => {\r\n                    if(item.active)\r\n                    {\r\n                        setTopics((topics) => [...topics, item]);\r\n                    }\r\n                    else\r\n                    {\r\n                        setTopicsPending((topics) => [...topics, item]);\r\n                    }\r\n                })\r\n                setLoading(false)\r\n            }\r\n            \r\n        }\r\n\r\n        getTopics();\r\n\r\n        return () => {\r\n            isMounted = false;\r\n            setLoading(false)\r\n        }\r\n    }, [])\r\n    \r\n    React.useEffect(() => {\r\n    channel1.bind(\"App\\\\Events\\\\Notification\", (data) => {\r\n      setNotification((noti) => [...noti, data.data]);\r\n    });\r\n  }, []);\r\n    \r\n    React.useEffect(() => {\r\n    channel2.bind(\"App\\\\Events\\\\Topic\", (data) => {\r\n      if (data.data.resource_id === `chude_${user.malop}`) {\r\n        if (data.data.isDelete) {\r\n          if (data.data.active) {\r\n            //   const newData = tailieu.filter((item) => item._id !== data.data._id);\r\n            setTopics((topics) =>\r\n              topics.filter((item) => item._id !== data.data._id)\r\n            );\r\n          } else {\r\n            setTopicsPending((topics) =>\r\n              topics.filter((item) => item._id !== data.data._id)\r\n            );\r\n          }\r\n        }\r\n\r\n        if (data.data.isAdd === true) {\r\n          let item = data.data;\r\n          item._id = item._id;\r\n          if (item.active === true) {\r\n            setTopics((topics) => [...topics, item]);\r\n          } else {\r\n            setTopicsPending((topics) => [...topics, item]);\r\n          }\r\n        }\r\n\r\n        if (data.data.isUpdate === true) {\r\n          if (data.data.active) {\r\n            setTopics((topics) =>\r\n              topics.map((item) =>\r\n                item._id === data.data._id ? data.data : item\r\n              )\r\n            );\r\n          } else {\r\n            setTopics((topics) =>\r\n              topics.filter((item) => item._id !== data.data._id)\r\n            );\r\n            setTopicsPending((topics) => [...topics, data.data]);\r\n          }\r\n        }\r\n\r\n        if (data.data.isApprove === true) {\r\n          setTopics((topics) => [...topics, data.data]);\r\n          setTopicsPending((topics) =>\r\n            topics.filter((item) => item._id !== data.data._id)\r\n          );\r\n        }\r\n      }\r\n    });\r\n  }, []);\r\n\r\n    return (\r\n\r\n        loading ? <ClipLoader /> : props.accessRightsForum.allowRead === true ?\r\n            props.isCreateTopicResource !== null ? props.isCreateTopicResource === true ?\r\n            <div>\r\n                <DanhSachDienDan\r\n                    notification={notification}\r\n                    topics={topics}\r\n                    topicsPending={topicsPending}\r\n                    userlogin={user}\r\n                    handleCreate={addTopic}\r\n                    handleDelete={deleteTopic}\r\n                    handleEdit={editTopic}\r\n                    handleApprove={handleApprove}\r\n                    accessRights={props.accessRightsForum}\r\n                    getUserNameOfUser={get_username_of_mauser}\r\n                />\r\n            </div> : <button className=\"btn btn-primary\" onClick={() => CreateANewTopicResource(props.user.malop, `Chủ đề của lớp ${props.privateInfo.tenlop}`)}>Nhấn vào đây để tạo mới một resource</button> : \"...Loading...\"\r\n            : props.accessRightsForum.allowRead === false ? <h5>Bạn không được phép truy cập vào trang này.</h5> : \"...Loading...\"\r\n\r\n    )\r\n}\r\n\r\nexport default DienDan\r\n"]},"metadata":{},"sourceType":"module"}