{"ast":null,"code":"var _jsxFileName = \"C:\\\\Projects_User\\\\lucky\\\\full_project\\\\frontend\\\\src\\\\components\\\\page\\\\GiaoVien\\\\TestSchedule.js\",\n    _s = $RefreshSig$();\n\nimport * as React from 'react';\nimport { ViewState, EditingState, IntegratedEditing } from '@devexpress/dx-react-scheduler';\nimport ClipLoader from \"react-spinners/ClipLoader\";\nimport { Scheduler // Toolbar là thanh chứa viewSwitcher  \n, Toolbar, ViewSwitcher, DayView, WeekView //   renders a date navigator control\n, DateNavigator // display today button\n, TodayButton, Appointments, AppointmentForm, AppointmentTooltip } from '@devexpress/dx-react-scheduler-material-ui';\nimport appointments from './today_appointment';\nimport axios from 'axios';\nimport { userContext } from '../../../Store';\nimport Header from '../../basic_components/Header';\nimport Footer from '../../basic_components/Footer';\nimport { channel3 } from \"../../../Store\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction TestSchedule(props) {\n  _s();\n\n  const view_id = \"view_01\"; // cái này là trùng với resource_id trong bảng resources\n\n  const [currentDate, setCurrentDate] = React.useState(new Date()); // set ngày hiện tại cho lịch\n\n  const [data, setData] = React.useState([]);\n  const [addedAppointment, setAddedAppointment] = React.useState({});\n  const [isBeingCreated, setIsBeingCreated] = React.useState(false); // const isMountedVal = React.useRef(1);\n\n  const [user, setUser] = React.useContext(userContext);\n  console.log(user); // const [user, setUser] = React.useContext(userContext);\n\n  const [roleOfUser, setRoleOfUser] = React.useState([]);\n  const [accessRights, setAccessRights] = React.useState({\n    allowReading: false,\n    allowAdding: false,\n    allowUpdating: false,\n    allowDeleting: false\n  });\n\n  const check_access_rights = async () => {\n    // try {\n    const result = await axios.post('/api/check-access-rights-for-schedule-calendar', {\n      mauser: user.mauser,\n      resource_id: view_id,\n      magiaovien: user.magiaovien\n    });\n    console.log(result);\n\n    if (result.data.status === true) {\n      console.log(result);\n      const {\n        accessRights\n      } = result.data;\n      setAccessRights({\n        allowReading: accessRights.allowRead,\n        allowAdding: accessRights.allowAdd,\n        allowUpdating: accessRights.allowUpdate,\n        allowDeleting: accessRights.allowDelete\n      });\n\n      if (accessRights.allowRead === true) {\n        const newdata = result.data.dataList.map(item => {\n          return { ...item,\n            startDate: new Date(item.startDate),\n            endDate: new Date(item.endDate)\n          };\n        });\n        setData(newdata);\n        setRoleOfUser(accessRights.user_role);\n      } // console.log(result.data.dataList)\n\n    } // } catch (err) {\n    //     console.log(err)\n    // }\n\n  };\n\n  const currentDateChange = currentDate => {\n    setCurrentDate(currentDate);\n  };\n\n  const onAddedAppointmentChange = addedAppointment => {\n    setAddedAppointment(addedAppointment);\n    setIsBeingCreated(true);\n  };\n\n  React.useEffect(() => {\n    channel3.bind(\"App\\\\Events\\\\ScheduleCalendarEvent\", data => {\n      console.log(\"pusher\", data);\n\n      if (data.data.magiaovien === user.magiaovien) {\n        if (data.data.isAdd) {\n          const {\n            allDay,\n            id,\n            title,\n            startDate,\n            endDate\n          } = data.data;\n          setData(schedule => [...schedule, {\n            allDay,\n            id,\n            title,\n            startDate,\n            endDate\n          }]);\n          setIsBeingCreated(false);\n        }\n\n        if (data.data.isUpdate) {\n          const {\n            allDay,\n            id,\n            title,\n            startDate,\n            endDate\n          } = data.data;\n          setData(schedule => schedule.map(item => item.id === id ? {\n            allDay,\n            id,\n            title,\n            startDate,\n            endDate\n          } : item));\n        }\n\n        if (data.data.isDelete) {\n          const {\n            id\n          } = data.data;\n          setData(schedule => schedule.filter(item => item.id !== id));\n        }\n      }\n    });\n  }, []);\n\n  const onCommitChanges = props => {\n    const {\n      added,\n      changed,\n      deleted\n    } = props;\n\n    if (added) {\n      const appointmentLength = data.length;\n      const new_data_added = { ...added,\n        id: appointmentLength + 1\n      }; //             setData((data) => [...data, new_data_added]);\n      //             setIsBeingCreated(false);\n\n      axios.post('/api/add-appointment', { ...new_data_added,\n        magiaovien: user.mauser\n      }).then(res => console.log(res)).catch(err => console.log(err));\n    }\n\n    if (changed) {\n      //             const new_data = data.map((appointment) => (changed[appointment.id] ?\n      //                 { ...appointment, ...changed[appointment.id] } : appointment\n      //             )\n      //             )\n      //             setData(new_data);\n      data.map(appointment => {\n        if (changed[appointment.id]) {\n          const edit_data = { ...appointment,\n            ...changed[appointment.id]\n          };\n          axios.post('/api/edit-appointment', { ...edit_data,\n            magiaovien: user.mauser\n          }).then(res => console.log(res)).catch(err => console.log(err));\n        }\n      });\n    }\n\n    if (deleted) {\n      //             const new_data = data.filter(item => item.id !== deleted)\n      //             setData(new_data)\n      axios.post('/api/delete-appointment', {\n        id: deleted,\n        magiaovien: user.mauser\n      }).then(res => console.log(res)).catch(err => console.log(err));\n    }\n\n    setIsBeingCreated(false);\n    return appointments;\n  };\n\n  const {\n    allowReading,\n    allowAdding,\n    allowUpdating,\n    allowDeleting\n  } = accessRights; // Xử lý không cho phép adding bằng cách tắt onDoubleClick handler \n\n  const TimeTableCell = React.useCallback( /*#__PURE__*/React.memo(({\n    onDoubleClick,\n    ...restProps\n  }) => /*#__PURE__*/_jsxDEV(WeekView.TimeTableCell, { ...restProps,\n    onDoubleClick: allowAdding ? onDoubleClick : undefined\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 173,\n    columnNumber: 9\n  }, this)), [allowAdding]); // Xử lý không cho phép xóa:\n\n  const CommandButton = ({\n    id,\n    ...restProps\n  }) => {\n    console.log(id); //saveButton, deleteButton, cancelButton\n    // ra 3 nút có trên giao diện, kiểm tra xem nếu là nút delete thì sẽ tùy chỉnh disable trái ngược với option về edit bên trên\n\n    if (id === 'deleteButton') {\n      return /*#__PURE__*/_jsxDEV(AppointmentForm.CommandButton, {\n        id: id,\n        ...restProps,\n        disabled: !allowDeleting\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 20\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(AppointmentForm.CommandButton, {\n        id: id,\n        ...restProps\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 20\n      }, this);\n    }\n  };\n\n  const view_schedule_calendar = () => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(React.Fragment, {\n        children: /*#__PURE__*/_jsxDEV(Scheduler, {\n          data: data,\n          children: [/*#__PURE__*/_jsxDEV(ViewState, {\n            currentDate: currentDate,\n            defaultCurrentDate: currentDate,\n            defaultCurrentViewName: \"Week\",\n            onCurrentDateChange: currentDateChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(EditingState, {\n            onCommitChanges: onCommitChanges,\n            addedAppointment: addedAppointment,\n            onAddedAppointmentChange: onAddedAppointmentChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(IntegratedEditing, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Toolbar, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(DateNavigator, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 219,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(TodayButton, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(ViewSwitcher, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(DayView, {\n            displayName: \"Day Work\",\n            startDayHour: 8,\n            endDayHour: 22\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(WeekView, {\n            displayName: \"Week Work\",\n            startDayHour: 8,\n            endDayHour: 22,\n            timeTableCellComponent: TimeTableCell\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Appointments, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(AppointmentTooltip, {\n            showOpenButton: true,\n            showCloseButton: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(AppointmentForm, {\n            commandButtonComponent: CommandButton,\n            readOnly: isBeingCreated ? false : !allowUpdating\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 13\n    }, this);\n  };\n\n  React.useEffect(() => {\n    if (user.name !== \"\") {\n      check_access_rights();\n    }\n\n    return () => {\n      setRoleOfUser([]);\n      setAccessRights({});\n      setData([]);\n    };\n  }, [user.name]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 265,\n      columnNumber: 13\n    }, this), roleOfUser.length !== 0 ? accessRights.allowReading === true ? view_schedule_calendar() : \"Bạn không có quyền truy cập vào trang này\" : /*#__PURE__*/_jsxDEV(ClipLoader, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 59\n    }, this), /*#__PURE__*/_jsxDEV(Footer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 264,\n    columnNumber: 9\n  }, this);\n}\n\n_s(TestSchedule, \"MgM2mhKQ42kljR6KvR8FrLCrnJ8=\");\n\n_c = TestSchedule;\nexport default TestSchedule;\n\nvar _c;\n\n$RefreshReg$(_c, \"TestSchedule\");","map":{"version":3,"sources":["C:/Projects_User/lucky/full_project/frontend/src/components/page/GiaoVien/TestSchedule.js"],"names":["React","ViewState","EditingState","IntegratedEditing","ClipLoader","Scheduler","Toolbar","ViewSwitcher","DayView","WeekView","DateNavigator","TodayButton","Appointments","AppointmentForm","AppointmentTooltip","appointments","axios","userContext","Header","Footer","channel3","TestSchedule","props","view_id","currentDate","setCurrentDate","useState","Date","data","setData","addedAppointment","setAddedAppointment","isBeingCreated","setIsBeingCreated","user","setUser","useContext","console","log","roleOfUser","setRoleOfUser","accessRights","setAccessRights","allowReading","allowAdding","allowUpdating","allowDeleting","check_access_rights","result","post","mauser","resource_id","magiaovien","status","allowRead","allowAdd","allowUpdate","allowDelete","newdata","dataList","map","item","startDate","endDate","user_role","currentDateChange","onAddedAppointmentChange","useEffect","bind","isAdd","allDay","id","title","schedule","isUpdate","isDelete","filter","onCommitChanges","added","changed","deleted","appointmentLength","length","new_data_added","then","res","catch","err","appointment","edit_data","TimeTableCell","useCallback","memo","onDoubleClick","restProps","undefined","CommandButton","view_schedule_calendar","name"],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport { ViewState, EditingState, IntegratedEditing, } from '@devexpress/dx-react-scheduler';\r\n\r\nimport ClipLoader from \"react-spinners/ClipLoader\";\r\n\r\n\r\nimport {\r\n    Scheduler,\r\n    // Toolbar là thanh chứa viewSwitcher  \r\n    Toolbar,\r\n    ViewSwitcher,\r\n    DayView,\r\n    WeekView,\r\n\r\n    //   renders a date navigator control\r\n    DateNavigator,\r\n\r\n    // display today button\r\n    TodayButton,\r\n\r\n    Appointments,\r\n    AppointmentForm,\r\n    AppointmentTooltip,\r\n} from '@devexpress/dx-react-scheduler-material-ui';\r\n\r\nimport appointments from './today_appointment';\r\nimport axios from 'axios';\r\n\r\nimport { userContext } from '../../../Store'\r\nimport Header from '../../basic_components/Header';\r\nimport Footer from '../../basic_components/Footer';\r\nimport { channel3 } from \"../../../Store\";\r\n\r\nfunction TestSchedule(props) {\r\n\r\n    const view_id = \"view_01\"; // cái này là trùng với resource_id trong bảng resources\r\n    const [currentDate, setCurrentDate] = React.useState(new Date()); // set ngày hiện tại cho lịch\r\n    const [data, setData] = React.useState([])\r\n\r\n    const [addedAppointment, setAddedAppointment] = React.useState({})\r\n    const [isBeingCreated, setIsBeingCreated] = React.useState(false);\r\n\r\n    // const isMountedVal = React.useRef(1);\r\n    const [user, setUser] = React.useContext(userContext);\r\n    console.log(user);\r\n    // const [user, setUser] = React.useContext(userContext);\r\n\r\n    const [roleOfUser, setRoleOfUser] = React.useState([]);\r\n    const [accessRights, setAccessRights] = React.useState({\r\n        allowReading: false,\r\n        allowAdding: false,\r\n        allowUpdating: false,\r\n        allowDeleting: false,\r\n    })\r\n\r\n    const check_access_rights = async () => {\r\n        // try {\r\n        const result = await axios.post('/api/check-access-rights-for-schedule-calendar', {\r\n            mauser: user.mauser,\r\n            resource_id: view_id,\r\n            magiaovien: user.magiaovien,\r\n        })\r\n        console.log(result);\r\n        if (result.data.status === true) {\r\n            console.log(result)\r\n            const { accessRights } = result.data;\r\n\r\n            setAccessRights({\r\n                allowReading: accessRights.allowRead,\r\n                allowAdding: accessRights.allowAdd,\r\n                allowUpdating: accessRights.allowUpdate,\r\n                allowDeleting: accessRights.allowDelete,\r\n            });\r\n\r\n            if (accessRights.allowRead === true) {\r\n                const newdata = result.data.dataList.map(item => {\r\n                    return {\r\n                        ...item,\r\n                        startDate: new Date(item.startDate),\r\n                        endDate: new Date(item.endDate),\r\n                    }\r\n                })\r\n                setData(newdata);\r\n\r\n                setRoleOfUser(accessRights.user_role);\r\n            }\r\n\r\n            // console.log(result.data.dataList)\r\n\r\n        }\r\n        // } catch (err) {\r\n        //     console.log(err)\r\n        // }\r\n\r\n    }\r\n\r\n    const currentDateChange = (currentDate) => {\r\n        setCurrentDate(currentDate)\r\n    }\r\n\r\n    const onAddedAppointmentChange = (addedAppointment) => {\r\n        setAddedAppointment(addedAppointment);\r\n        setIsBeingCreated(true)\r\n    }\r\n    \r\n    React.useEffect(() => {\r\n    channel3.bind(\"App\\\\Events\\\\ScheduleCalendarEvent\", (data) => {\r\n      console.log(\"pusher\", data);\r\n      if (data.data.magiaovien === user.magiaovien) {\r\n        if (data.data.isAdd) {\r\n          const { allDay, id, title, startDate, endDate } = data.data;\r\n          setData((schedule) => [\r\n            ...schedule,\r\n            { allDay, id, title, startDate, endDate },\r\n          ]);\r\n          setIsBeingCreated(false);\r\n        }\r\n\r\n        if (data.data.isUpdate) {\r\n          const { allDay, id, title, startDate, endDate } = data.data;\r\n          setData((schedule) =>\r\n            schedule.map((item) =>\r\n              item.id === id ? { allDay, id, title, startDate, endDate } : item\r\n            )\r\n          );\r\n        }\r\n\r\n        if (data.data.isDelete) {\r\n          const { id } = data.data;\r\n          setData((schedule) => schedule.filter((item) => item.id !== id));\r\n        }\r\n      }\r\n    });\r\n  }, []);\r\n\r\n    const onCommitChanges = (props) => {\r\n        const { added, changed, deleted } = props;\r\n        if (added) {\r\n            const appointmentLength = data.length;\r\n            const new_data_added = { ...added, id: appointmentLength + 1 };\r\n//             setData((data) => [...data, new_data_added]);\r\n//             setIsBeingCreated(false);\r\n\r\n            axios.post('/api/add-appointment', { ...new_data_added, magiaovien: user.mauser }).then(res => console.log(res)).catch(err => console.log(err))\r\n        }\r\n        if (changed) {\r\n//             const new_data = data.map((appointment) => (changed[appointment.id] ?\r\n//                 { ...appointment, ...changed[appointment.id] } : appointment\r\n//             )\r\n//             )\r\n//             setData(new_data);\r\n\r\n            data.map((appointment) => {\r\n                if (changed[appointment.id]) {\r\n                    const edit_data = { ...appointment, ...changed[appointment.id] }\r\n                    axios.post('/api/edit-appointment', { ...edit_data, magiaovien: user.mauser }).then(res => console.log(res)).catch(err => console.log(err))\r\n                }\r\n            })\r\n        }\r\n        if (deleted) {\r\n//             const new_data = data.filter(item => item.id !== deleted)\r\n//             setData(new_data)\r\n            axios.post('/api/delete-appointment', { id: deleted, magiaovien: user.mauser }).then(res => console.log(res)).catch(err => console.log(err))\r\n        }\r\n        setIsBeingCreated(false);\r\n        return appointments;\r\n    }\r\n\r\n    const { allowReading, allowAdding, allowUpdating, allowDeleting } = accessRights;\r\n\r\n    // Xử lý không cho phép adding bằng cách tắt onDoubleClick handler \r\n    const TimeTableCell = React.useCallback(React.memo(({ onDoubleClick, ...restProps }) => (\r\n        <WeekView.TimeTableCell\r\n            {...restProps}\r\n            onDoubleClick={allowAdding ? onDoubleClick : undefined}\r\n        />\r\n    )), [allowAdding]);\r\n\r\n    // Xử lý không cho phép xóa:\r\n    const CommandButton = ({ id, ...restProps }) => {\r\n        console.log(id); //saveButton, deleteButton, cancelButton\r\n        // ra 3 nút có trên giao diện, kiểm tra xem nếu là nút delete thì sẽ tùy chỉnh disable trái ngược với option về edit bên trên\r\n        if (id === 'deleteButton') {\r\n            return <AppointmentForm.CommandButton id={id} {...restProps} disabled={!allowDeleting} />\r\n        }\r\n        else {\r\n            return <AppointmentForm.CommandButton id={id} {...restProps} />\r\n        }\r\n    }\r\n\r\n    const view_schedule_calendar = () => {\r\n        return (\r\n            <div>\r\n\r\n                <React.Fragment>\r\n                        <Scheduler\r\n                            data={data}\r\n                        >\r\n\r\n                            <ViewState\r\n                                currentDate={currentDate}\r\n                                defaultCurrentDate={currentDate}\r\n                                defaultCurrentViewName=\"Week\"\r\n                                onCurrentDateChange={currentDateChange}\r\n                            />\r\n\r\n                            <EditingState\r\n                                onCommitChanges={onCommitChanges}\r\n\r\n                                addedAppointment={addedAppointment}\r\n                                onAddedAppointmentChange={onAddedAppointmentChange}\r\n                            />\r\n\r\n                            {/* Bắt sự kiện edit khi nhấn onCommitChanges */}\r\n                            <IntegratedEditing />\r\n\r\n                            {/* Toolbar chứa button ViewSwitcher */}\r\n                            <Toolbar />\r\n                            <DateNavigator />\r\n                            <TodayButton />\r\n                            <ViewSwitcher />\r\n\r\n                            <DayView\r\n                                displayName=\"Day Work\"\r\n                                startDayHour={8}\r\n                                endDayHour={22}\r\n                            />\r\n                            <WeekView\r\n                                displayName=\"Week Work\"\r\n                                startDayHour={8}\r\n                                endDayHour={22}\r\n                                timeTableCellComponent={TimeTableCell}\r\n                            />\r\n                            <Appointments />\r\n                            <AppointmentTooltip\r\n                                showOpenButton\r\n                                showCloseButton\r\n                            />\r\n                            <AppointmentForm\r\n                                commandButtonComponent={CommandButton}\r\n                                readOnly={isBeingCreated ? false : !allowUpdating}\r\n                            />\r\n                        </Scheduler>\r\n                </React.Fragment>\r\n\r\n            </div>\r\n        )\r\n    }\r\n\r\n\r\n    React.useEffect(() => {\r\n        if (user.name !== \"\") {\r\n            check_access_rights();\r\n        }\r\n\r\n        return () => {\r\n            setRoleOfUser([])\r\n            setAccessRights({})\r\n            setData([])\r\n        }\r\n    }, [user.name])\r\n\r\n    return (\r\n        <div>\r\n            <Header />\r\n            {roleOfUser.length !== 0 ? accessRights.allowReading === true ? (\r\n\r\n            view_schedule_calendar()\r\n\r\n        ) : \"Bạn không có quyền truy cập vào trang này\" : <ClipLoader/>}\r\n\r\n            <Footer />\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TestSchedule\r\n"]},"metadata":{},"sourceType":"module"}